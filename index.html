<div id="cusdis_container"></div>

<script>
  const params = new URLSearchParams(window.location.search);
  const slug = params.get("id");

  const pageId = slug || "default";
  const pageUrl = slug 
    ? `https://haris.super.site/all-post/${slug}` 
    : "https://haris.super.site/";
  const pageTitle = slug ? slug.replace(/-/g, " ") : "Homepage";

  function injectCusdis(theme) {
    const container = document.getElementById('cusdis_container');
    container.innerHTML = `
      <div id="cusdis_thread"
           data-host="https://cusdis.com"
           data-app-id="1f0f4961-7dff-4e85-828c-012202515f73"
           data-page-id="${pageId}"
           data-page-url="${pageUrl}"
           data-page-title="${pageTitle}"
           data-theme="${theme}">
      </div>
    `;

    const oldScript = document.querySelector('script[data-cusdis-script]');
    if (oldScript) oldScript.remove();

    const script = document.createElement('script');
    script.src = 'https://cusdis.com/js/cusdis.es.js';
    script.async = true;
    script.defer = true;
    script.setAttribute('data-cusdis-script', 'true');
    document.body.appendChild(script);
  }

  function getTheme() {
    return document.documentElement.classList.contains('dark') ? 'dark' : 'light';
  }

  // Load pertama
  injectCusdis(getTheme());

  // Pantau perubahan class HTML (untuk dark/light toggle)
  const observer = new MutationObserver(() => {
    injectCusdis(getTheme());
  });

  observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
</script>